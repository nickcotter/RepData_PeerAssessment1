---
title: "Reproducible Research: Peer Assessment 1"
output: 
html_document:
keep_md: true
---

## Use these libraries
```{r message=FALSE}
library(knitr)
library(dplyr)
library(ggplot2)
```


## Loading and preprocessing the data
```{r}
unzip("activity.zip")
raw_activity <- read.csv("activity.csv")

# remove missing data and turn date column into date type
activity <- na.omit(raw_activity)
activity$date <- as.Date(activity$date)

kable(summary(raw_activity))
```



## What is mean total number of steps taken per day?
```{r}

steps_by_day <- activity %>%
            group_by(date) %>%
            summarise(total=sum(steps))

meansteps <- mean(steps_by_day$total)
mediansteps <- median(steps_by_day$total)

```

The mean number of steps per day is `r format(meansteps, scientific=FALSE)`, and the median number of steps per day is `r format(mediansteps, scientific=FALSE)`.


## What is the average daily activity pattern?
```{r}

mean_steps_by_interval <- activity %>%
            group_by(interval) %>%
            summarise(meansteps=mean(steps))

interval_with_max_steps <- mean_steps_by_interval$interval[which.max(mean_steps_by_interval$meansteps)]

plot(mean_steps_by_interval$interval, mean_steps_by_interval$meansteps, 
     type="l",
     xlab="5 Minute Interval",
     ylab="Average Steps Taken/Interval",
     main="Average Steps Taken during 5 minute interval")

```

The maximum number of steps occurred during 5-minute interval `r interval_with_max_steps`.

## Imputing missing values

```{r}
missing_count <- sum(is.na(raw_activity$steps))
```

There are `r missing_count` missing values in the dataset.

```{r}

imputeMissingValue <- function(steps, interval) {
  imputedSteps <- NA
  if (!is.na(steps))
    imputedSteps <- steps
  else 
    imputedSteps <- mean_steps_by_interval[mean_steps_by_interval$interval == interval, "meansteps"]
}

imputed_data <- raw_activity
imputed_data$imputed_steps <- as.numeric(mapply(imputeMissingValue, imputed_data$steps, imputed_data$interval))
imputed_data$date <- as.Date(imputed_data$date)

total_imputed_steps_per_day <- imputed_data %>%
          group_by(date) %>%
          summarise(totalsteps=sum(imputed_steps))

hist(total_imputed_steps_per_day$totalsteps, 
     xlab="Total # steps taken each day", 
     ylab="Count", 
     main="Total # steps taken each day",
     col=3)

```

```{r}
imputed_mean_steps <- mean(total_imputed_steps_per_day$totalsteps)
imputed_median_steps <- median(total_imputed_steps_per_day$totalsteps)
```

The mean number of steps per day is `r format(imputed_mean_steps, scientific=FALSE)`, and the median number of steps per day is `r format(imputed_median_steps, scientific=FALSE)`.

## Are there differences in activity patterns between weekdays and weekends?

Add a column denoting day type, ie weekday or weekend:
```{r}
imputed_data$day <- weekdays(imputed_data$date)
weekend_days <- c("Saturday", "Sunday")
imputed_with_day_type <- mutate(imputed_data, daytype=factor(case_when(day %in% weekend_days ~ "weekend", TRUE ~ "weekday")))
```

Group by interval and add mean step count for each interval:
```{r}
average_by_day_type <- imputed_with_day_type %>%
    group_by(daytype, interval) %>%
    summarise(meansteps=mean(imputed_steps))

```

Plot average number of steps taken in weekends and weekdays:
```{r}
qplot(interval, meansteps, data=average_by_day_type,
      geom="line",
      xlab="Interval",
      ylab="Number of Steps (Average)",
      main="Average steps taken Weekends vs. Weekdays",
      facets =daytype ~ .)

```

Activity starts earlier on weekdays.